var Hogan={};(function(e,t){function n(e){return(null===e||void 0===e?"":e)+""}function r(e){e=n(e);return c.test(e)?e.replace(i,"&amp;").replace(o,"&lt;").replace(a,"&gt;").replace(u,"&#39;").replace(s,"&quot;"):e}e.Template=function(e,n,r,i){this.r=e||this.r;this.c=r;this.options=i;this.text=n||"";this.buf=t?[]:""};e.Template.prototype={r:function(){return""},v:r,t:n,render:function(e,t,n){return this.ri([e],t||{},n)},ri:function(e,t,n){return this.r(e,t,n)},rp:function(e,t,n,r){var i=n[e];if(!i)return"";this.c&&"string"==typeof i&&(i=this.c.compile(i,this.options));return i.ri(t,n,r)},rs:function(e,t,n){var r=e[e.length-1];if(l(r))for(var i=0;r.length>i;i++){e.push(r[i]);n(e,t,this);e.pop()}else n(e,t,this)},s:function(e,t,n,r,i,o,a){var u;if(l(e)&&0===e.length)return!1;"function"==typeof e&&(e=this.ls(e,t,n,r,i,o,a));u=""===e||!!e;!r&&u&&t&&t.push("object"==typeof e?e:t[t.length-1]);return u},d:function(e,t,n,r){var i=e.split("."),o=this.f(i[0],t,n,r),a=null;if("."===e&&l(t[t.length-2]))return t[t.length-1];for(var u=1;i.length>u;u++)if(o&&"object"==typeof o&&i[u]in o){a=o;o=o[i[u]]}else o="";if(r&&!o)return!1;if(!r&&"function"==typeof o){t.push(a);o=this.lv(o,t,n);t.pop()}return o},f:function(e,t,n,r){for(var i=!1,o=null,a=!1,u=t.length-1;u>=0;u--){o=t[u];if(o&&"object"==typeof o&&e in o){i=o[e];a=!0;break}}if(!a)return r?!1:"";r||"function"!=typeof i||(i=this.lv(i,t,n));return i},ho:function(e,t,n,r,i){var o=this.c,a=this.options;a.delimiters=i;var r=e.call(t,r);r=null==r?r+"":""+r;this.b(o.compile(r,a).render(t,n));return!1},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");this.buf=[];return e}:function(){var e=this.buf;this.buf="";return e},ls:function(e,t,n,r,i,o,a){var u=t[t.length-1],s=null;if(!r&&this.c&&e.length>0)return this.ho(e,u,n,this.text.substring(i,o),a);s=e.call(u);if("function"==typeof s){if(r)return!0;if(this.c)return this.ho(s,u,n,this.text.substring(i,o),a)}return s},lv:function(e,t,r){var i=t[t.length-1],o=e.call(i);if("function"==typeof o){o=n(o.call(i));if(this.c&&~o.indexOf("{{"))return this.c.compile(o,this.options).render(i,r)}return n(o)}};var i=/&/g,o=/</g,a=/>/g,u=/\'/g,s=/\"/g,c=/[&<>\"\']/,l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}})("undefined"!=typeof exports?exports:Hogan);(function(){"use strict";var e="c631ef46e918c82cf81ef4869f0029d4";angular.module("shuttle",[]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/main_menu.html"}).when("/planner",{templateUrl:"partials/planner.html",controller:"planController"}).when("/planner/:fromPlace/:toPlace/:when/:time/:date",{templateUrl:"partials/planner.html",controller:"planController"}).when("/list",{templateUrl:"partials/routeList.html",controller:"routeMenuController"}).when("/schedule//:stop",{templateUrl:"partials/routeList.html",controller:"routeMenuController"}).when("/locations",{templateUrl:"partials/stopList.html",controller:"stopController"}).when("/schedule/:route",{templateUrl:"partials/stopList.html",controller:"stopController"}).when("/schedule/:route/:stop",{templateUrl:"partials/schedule.html",controller:"scheduleController"}).otherwise({redirectTo:"/"})}]).controller("scheduleController",["$scope","$routeParams","$filter",function(t,n,r){t.loading=!0;t.loadError=!1;t.loaded=!1;var i=(new Date).setHours(0,0,0,0),o={apikey:e,routeId:n.route,stopId:n.stop,startTime:i,endTime:i+86399999},a=function(){UCSF.Shuttle.times(o,function(e){t.loading=!1;t.loadError=!!e.error;t.loaded=!t.loadError;t.times=[];if(e.times&&e.times.length>0){t.times=e.times;var n=e.times[0];if(n&&n.trip){t.routeShortName=n.trip.route&&n.trip.route.shortName;t.routeId=n.trip.routeId&&n.trip.routeId.id}}t.startTime=i;t.$apply()},function(){t.loading=!1;t.loadError=!0;t.$apply()})};t.changeDay=function(e){var n=864e5*e;i=o.startTime+=n;o.endTime+=n;t.loading=!0;t.loaded=!1;a()};a();UCSF.Shuttle.stops({apikey:e,routeId:n.route},function(e){var i=r("filter")(e.stops,function(e){return e.id&&e.id.id===n.stop}).pop();t.stopName=i&&i.stopName;t.$apply()},function(){})}]).controller("stopController",["$scope","$routeParams",function(t,n){t.loading=!0;t.loadError=!1;var r={apikey:e};n.route&&(r.routeId=n.route);UCSF.Shuttle.stops(r,function(e){t.loading=!1;t.stops=e.stops||[];if(e.route&&e.route.id){t.routeShortName=e.route.routeShortName||"";t.routeId=e.route.id.id}t.loadError=0===t.stops.length;t.$apply()},function(){t.loading=!1;t.loadError=!0;t.$apply()})}]).controller("routeMenuController",["$scope","$routeParams",function(t,n){t.loading=!0;t.loadError=!1;var r={apikey:e};n.stop&&(r.stopId=n.stop);UCSF.Shuttle.routes(r,function(e){t.loading=!1;t.routes=e.routes||{};t.$apply()},function(){t.loading=!1;t.loadError=!0;t.$apply()})}]).controller("planController",["$scope","$filter","$location","$routeParams",function(t,n,r,i){t.planLoading=!1;t.planLoaded=!1;t.planLoadError=!1;if(i.fromPlace&&i.toPlace&&i.when&&i.time&&i.date){var o={apikey:e,fromPlace:i.fromPlace,toPlace:i.toPlace};t.when=i.when;t.time=i.time;t.date=i.date;if("now"!==i.when){o.arriveBy="arrive"===i.when;o.time=i.time;var a=new Date;a.setDate(a.getDate()+parseInt(i.date,10));o.date=n("date")(a,"M/d/yyyy")}t.planLoading=!0;UCSF.Shuttle.plan(o,function(e){t.planLoading=!1;t.planLoaded=!0;var r=e.plan||{};if(r.itineraries){for(var i,o,a,u=r.date?r.date:Date.now(),s=144e5,c=1,l=r.itineraries.length,f=[],h=0;l>h;h++){a=r.itineraries[h];if(72e5>a.duration&&a.endTime>=u-s&&u+s>=a.endTime){a.index=c;c++;a.startTimeFormatted=n("date")(a.startTime,"shortTime");a.endTimeFormatted=n("date")(a.endTime,"shortTime");a.durationFormatted=Math.round(a.duration/6e4);if(a.hasOwnProperty("legs")){o=a.legs.length;for(var p=0;o>p;p++){i={};i.toName=a.legs[p].to.name;if("BUS"===a.legs[p].mode){i.fromName=a.legs[p].from.name;i.route=a.legs[p].route;i.routeId=a.legs[p].routeId;i.startTime=n("date")(a.legs[p].startTime,"shortTime");i.endTime=n("date")(a.legs[p].endTime,"shortTime");a.legs[p].bus=i}"WALK"===a.legs[p].mode&&(a.legs[p].walk=i)}}}else f.push(h)}h=f.length;for(;h--;)r.itineraries.splice(f[h],1);t.itineraries=r.itineraries}t.$apply()},function(){t.planLoading=!1;t.planLoadError=!0;t.$apply()})}if(!t.time){var u=Date.now(),s=15*Math.floor(parseInt(n("date")(u,"mm"),10)/15);0===s&&(s="00");t.time=n("date")(u,"h:"+s+" a")}t.when=t.when||"now";t.date=t.date||0;t.stopsLoading=!0;t.stopsLoadError=!1;t.stopsLoaded=!1;UCSF.Shuttle.stops({apikey:e},function(e){t.stopsLoading=!1;if(e.stops){t.stops=n("orderBy")(e.stops,"stopName");t.begin=n("filter")(t.stops,function(e){return"Parnassus Campus"===e.stopName})[0];t.end=n("filter")(t.stops,function(e){return"Mission Bay Campus"===e.stopName})[0];if(Modernizr.localstorage){localStorage.shuttleStart&&(t.begin=t.stops[localStorage.shuttleStart]||t.begin);localStorage.shuttleEnd&&(t.end=t.stops[localStorage.shuttleEnd]||t.end)}t.stopsLoaded=!0}else t.stopsLoadError=!0;t.$apply()},function(){t.stopsLoading=!1;t.stopsLoadError=!0;t.$apply()});t.plan=function(){var e=t.begin.id.agencyId+"_"+t.begin.id.id,n=t.end.id.agencyId+"_"+t.end.id.id;if(Modernizr.localstorage){localStorage.shuttleStart=t.stops.indexOf(t.begin);localStorage.shuttleEnd=t.stops.indexOf(t.end)}r.url("/planner/"+[e,n,t.when,t.time,t.date].join("/"))}}])})();