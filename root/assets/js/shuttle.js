var Hogan={};(function(e,t){function n(e){return(null===e||void 0===e?"":e)+""}function o(e){e=n(e);return u.test(e)?e.replace(i,"&amp;").replace(r,"&lt;").replace(a,"&gt;").replace(s,"&#39;").replace(l,"&quot;"):e}e.Template=function(e,n,o,i){this.r=e||this.r;this.c=o;this.options=i;this.text=n||"";this.buf=t?[]:""};e.Template.prototype={r:function(){return""},v:o,t:n,render:function(e,t,n){return this.ri([e],t||{},n)},ri:function(e,t,n){return this.r(e,t,n)},rp:function(e,t,n,o){var i=n[e];if(!i)return"";this.c&&"string"==typeof i&&(i=this.c.compile(i,this.options));return i.ri(t,n,o)},rs:function(e,t,n){var o=e[e.length-1];if(p(o))for(var i=0;o.length>i;i++){e.push(o[i]);n(e,t,this);e.pop()}else n(e,t,this)},s:function(e,t,n,o,i,r,a){var s;if(p(e)&&0===e.length)return!1;"function"==typeof e&&(e=this.ls(e,t,n,o,i,r,a));s=""===e||!!e;!o&&s&&t&&t.push("object"==typeof e?e:t[t.length-1]);return s},d:function(e,t,n,o){var i=e.split("."),r=this.f(i[0],t,n,o),a=null;if("."===e&&p(t[t.length-2]))return t[t.length-1];for(var s=1;i.length>s;s++)if(r&&"object"==typeof r&&i[s]in r){a=r;r=r[i[s]]}else r="";if(o&&!r)return!1;if(!o&&"function"==typeof r){t.push(a);r=this.lv(r,t,n);t.pop()}return r},f:function(e,t,n,o){for(var i=!1,r=null,a=!1,s=t.length-1;s>=0;s--){r=t[s];if(r&&"object"==typeof r&&e in r){i=r[e];a=!0;break}}if(!a)return o?!1:"";o||"function"!=typeof i||(i=this.lv(i,t,n));return i},ho:function(e,t,n,o,i){var r=this.c,a=this.options;a.delimiters=i;var o=e.call(t,o);o=null==o?o+"":""+o;this.b(r.compile(o,a).render(t,n));return!1},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");this.buf=[];return e}:function(){var e=this.buf;this.buf="";return e},ls:function(e,t,n,o,i,r,a){var s=t[t.length-1],l=null;if(!o&&this.c&&e.length>0)return this.ho(e,s,n,this.text.substring(i,r),a);l=e.call(s);if("function"==typeof l){if(o)return!0;if(this.c)return this.ho(l,s,n,this.text.substring(i,r),a)}return l},lv:function(e,t,o){var i=t[t.length-1],r=e.call(i);if("function"==typeof r){r=n(r.call(i));if(this.c&&~r.indexOf("{{"))return this.c.compile(r,this.options).render(i,o)}return n(r)}};var i=/&/g,r=/</g,a=/>/g,s=/\'/g,l=/\"/g,u=/[&<>\"\']/,p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}})("undefined"!=typeof exports?exports:Hogan);var ucsf=ucsf||{};ucsf.shuttle=function(){function e(e,t){t=t||{};var n=new Date(e),o=n.getHours(),i=n.getMinutes(),r=t.minutesIncrement?t.minutesIncrement:1;i=Math.floor(i/r)*r;var a=o>=12?"pm":"am";o%=12;o=o?o:12;i=10>i?"0"+i:i;return o+":"+i+a}function t(t){var n=document.getElementById("ucsf_shuttle_trip_form_container");if(n){var o=new Hogan.Template(function(e,t,n){var o=this;o.b(n=n||"");o.b('<form id="ucsf_shuttle_trip_form" action="/shuttle/planner/"><h2>Trip Planner</h2><select name="begin" id="ucsf_shuttle_starting_from">');if(o.s(o.f("stops",e,t,1),e,t,0,145,221,"{{ }}")){o.rs(e,t,function(e,t,n){n.b('<option value="');if(n.s(n.f("id",e,t,1),e,t,0,167,186,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("agencyId",e,t,0)));n.b("_");n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('">From ');n.b(n.v(n.f("stopName",e,t,0)));n.b("</option>")});e.pop()}o.b("</select>");o.s(o.f("stops",e,t,1),e,t,1,0,0,"")||o.b("<p>Content could not be loaded.</p>");o.b('<button type="button" id="reverse_trip" class="reverse_trip">&uarr;&darr;</button><select name="end" id="ucsf_shuttle_ending_at">');if(o.s(o.f("stops",e,t,1),e,t,0,434,508,"{{ }}")){o.rs(e,t,function(e,t,n){n.b('<option value="');if(n.s(n.f("id",e,t,1),e,t,0,456,475,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("agencyId",e,t,0)));n.b("_");n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('">To ');n.b(n.v(n.f("stopName",e,t,0)));n.b("</option>")});e.pop()}o.b("</select>");o.s(o.f("stops",e,t,1),e,t,1,0,0,"")||o.b("<p>Content could not be loaded.</p>");o.b('<fieldset disabled name="datetime"><legend><select class="compact" name="when" onchange="form.datetime.disabled = value==\'now\'"><option value="now">Leave now</option><option value="depart">Depart at</option><option value="arrive">Arrive by</option></select></legend><select class="compact" name="time"><option value="6:00am">6:00am</option><option value="6:15am">6:15am</option><option value="6:30am">6:30am</option><option value="6:45am">6:45am</option><option value="7:00am">7:00am</option><option value="7:15am">7:15am</option><option value="7:30am">7:30am</option><option value="7:45am">7:45am</option><option value="8:00am">8:00am</option><option value="8:15am">8:15am</option><option value="8:30am">8:30am</option><option value="8:45am">8:45am</option><option value="9:00am">9:00am</option><option value="9:15am">9:15am</option><option value="9:30am">9:30am</option><option value="9:45am">9:45am</option><option value="10:00am">10:00am</option><option value="10:15am">10:15am</option><option value="10:30am">10:30am</option><option value="10:45am">10:45am</option><option value="11:00am">11:00am</option><option value="11:15am">11:15am</option><option value="11:30am">11:30am</option><option value="11:45am">11:45am</option><option value="12:00pm">12:00pm</option><option value="12:15pm">12:15pm</option><option value="12:30pm">12:30pm</option><option value="12:45pm">12:45pm</option><option value="1:00pm">1:00pm</option><option value="1:15pm">1:15pm</option><option value="1:30pm">1:30pm</option><option value="1:45pm">1:45pm</option><option value="2:00pm">2:00pm</option><option value="2:15pm">2:15pm</option><option value="2:30pm">2:30pm</option><option value="2:45pm">2:45pm</option><option value="3:00pm">3:00pm</option><option value="3:15pm">3:15pm</option><option value="3:30pm">3:30pm</option><option value="3:45pm">3:45pm</option><option value="4:00pm">4:00pm</option><option value="4:15pm">4:15pm</option><option value="4:30pm">4:30pm</option><option value="4:45pm">4:45pm</option><option value="5:00pm">5:00pm</option><option value="5:15pm">5:15pm</option><option value="5:30pm">5:30pm</option><option value="5:45pm">5:45pm</option><option value="6:00pm">6:00pm</option><option value="6:15pm">6:15pm</option><option value="6:30pm">6:30pm</option><option value="6:45pm">6:45pm</option><option value="7:00pm">7:00pm</option><option value="7:15pm">7:15pm</option><option value="7:30pm">7:30pm</option><option value="7:45pm">7:45pm</option><option value="8:00pm">8:00pm</option><option value="8:15pm">8:15pm</option><option value="8:30pm">8:30pm</option><option value="8:45pm">8:45pm</option><option value="9:00pm">9:00pm</option></select><select class="compact" name="date"><option value="0">Today</option><option value="1">Tomorrow</option><option value="2">In 2 days</option><option value="3">In 3 days</option></select></fieldset><input type="submit" name="route" value="Route Trip"  /></form>');return o.fl()});n.innerHTML=o.render(t);var i=document.getElementById("ucsf_shuttle_trip_form"),r=i.begin,s=i.end,l=window.location.search.replace(/\+/g," ");if(l){var u=decodeURIComponent((/[&?]begin=([^&]*)/.exec(l)||["",""])[1]),p=decodeURIComponent((/[&?]end=([^&]*)/.exec(l)||["",""])[1]),c=decodeURIComponent((/[&?]when=([^&]*)/.exec(l)||["",""])[1]),d=decodeURIComponent((/[&?]time=([^&]*)/.exec(l)||["",""])[1]),f=decodeURIComponent((/[&?]date=([^&]*)/.exec(l)||["",""])[1]);r.value=u||r.value;s.value=p||s.value;i.when.value=c||i.when.value;i.time.value=d||i.time.value;i.date.value=f||i.date.value;a.plan()}else{i.time.value=e(Date.now(),{minutesIncrement:15});if(Modernizr.localstorage&&r&&s){if(localStorage.shuttle_start)r.selectedIndex=parseInt(localStorage.shuttle_start,10);else{var m=r.querySelector('option[value="ucsf_Parnassus"]');m&&(r.selectedIndex=m.index)}if(localStorage.shuttle_end)s.selectedIndex=parseInt(localStorage.shuttle_end,10);else{var h=s.querySelector('option[value="ucsf_MB"]');h&&(s.selectedIndex=h.index)}}}i.datetime.disabled="now"===i.when.value;var v=document.getElementById("reverse_trip");v&&(v.onclick=function(){var e;if(r&&s){e=r.selectedIndex;r.selectedIndex=s.selectedIndex;s.selectedIndex=e}})}}function n(e,t,n){var o=document.getElementById("ucsf_shuttle_list_"+e);o&&(o.innerHTML=new Hogan.Template(n).render(t))}function o(e){var t=null;if(Modernizr.localstorage&&localStorage[e])try{t=JSON.parse(localStorage[e])}catch(n){localStorage.removeItem("shuttle_stops")}return t}function i(e,t){Modernizr.localstorage&&t&&(localStorage[e]=JSON.stringify(t))}function r(e,t){var n=e.stopName?"stopName":"routeShortName";return e[n]<t[n]?-1:e[n]>t[n]?1:0}var a={};a.save=function(){if(Modernizr.localstorage){localStorage.shuttle_start=document.getElementById("ucsf_shuttle_starting_from").selectedIndex;localStorage.shuttle_end=document.getElementById("ucsf_shuttle_ending_at").selectedIndex}};a.renderStops=function(e){e.stops=e.stops||o("shuttle_stops");e.stops&&e.stops.sort(r);t(e);n("location",e,function(e,t,n){var o=this;o.b(n=n||"");o.b("<h2>Shuttles By Location</h2><ol>");if(o.s(o.f("stops",e,t,1),e,t,0,43,123,"{{ }}")){o.rs(e,t,function(e,t,n){n.b('<li><a href="/shuttle/list/?');if(n.s(n.f("id",e,t,1),e,t,0,87,93,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('">');n.b(n.v(n.f("stopName",e,t,0)));n.b("</a></li>")});e.pop()}o.b("</ol>");o.s(o.f("stops",e,t,1),e,t,1,0,0,"")||o.b("<p>Could not load content.</p>");return o.fl()});i("shuttle_stops",e.stops)};a.renderRoutes=function(e){e.routes=e.routes||o("shuttle_routes");e.routes&&e.routes.sort(r);n("color",e,function(e,t,n){var o=this;o.b(n=n||"");o.b("<h2>Shuttles ");if(o.s(o.f("stop",e,t,1),e,t,0,22,38,"{{ }}")){o.rs(e,t,function(e,t,n){n.b("for ");n.b(n.v(n.f("stopName",e,t,0)))});e.pop()}o.b("</h2><ol>");if(o.s(o.f("routes",e,t,1),e,t,0,67,205,"{{ }}")){o.rs(e,t,function(e,t,n){n.b('<li><a href="/shuttle/schedule/route?');if(n.s(n.f("id",e,t,1),e,t,0,108,114,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('"><div class="shuttle-color ');if(n.s(n.f("id",e,t,1),e,t,0,156,162,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('"></div> ');n.b(n.v(n.f("routeShortName",e,t,0)));n.b("</a></li>")});e.pop()}o.b("</ol>");o.s(o.f("routes",e,t,1),e,t,1,0,0,"")||o.b("<p>Could not load content.</p>");return o.fl()});i("shuttle_routes",e.routes)};a.renderScheduleMenu=function(e){var t=document.getElementById("ucsf_shuttle_schedule");if(t){var n=new Hogan.Template(function(e,t,n){var o=this;o.b(n=n||"");if(o.s(o.f("route",e,t,1),e,t,0,10,123,"{{ }}")){o.rs(e,t,function(e,t,n){n.b("<h2>");n.b(n.v(n.f("routeShortName",e,t,0)));n.b(' Shuttle Schedule</h2><ol id="ucsf-schedule-container" data-routeId="');if(n.s(n.f("id",e,t,1),e,t,0,108,114,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b('">')});e.pop()}if(o.s(o.f("stops",e,t,1),e,t,0,143,658,"{{ }}")){o.rs(e,t,function(e,t,n){n.b('<li><a href="#" data-stopId="');if(n.s(n.f("id",e,t,1),e,t,0,179,185,"{{ }}")){n.rs(e,t,function(e,t,n){n.b(n.v(n.f("id",e,t,0)))});e.pop()}n.b("\" onclick=\"ucsf.shuttle.renderSchedule.target=this;ucsf.shuttle.renderSchedule.startTime=new Date().setHours(0,0,0,0);UCSF.Shuttle.times({apikey:'c631ef46e918c82cf81ef4869f0029d4',");if(n.s(n.f("id",e,t,1),e,t,0,379,395,"{{ }}")){n.rs(e,t,function(e,t,n){n.b("stopId:'");n.b(n.v(n.f("id",e,t,0)));n.b("',")});e.pop()}n.b("routeId:document.getElementById('ucsf-schedule-container').getAttribute('data-routeId'),startTime:ucsf.shuttle.renderSchedule.startTime,endTime:ucsf.shuttle.renderSchedule.startTime+86399999},ucsf.shuttle.renderSchedule);return false\">");n.b(n.v(n.f("stopName",e,t,0)));n.b("</a></li>")});e.pop()}o.b("</ol>");o.s(o.f("stops",e,t,1),e,t,1,0,0,"")||o.b("<p>Could not load content.</p>");return o.fl()});t.innerHTML=n.render(e)}};a.renderSchedule=function(t){t.date=a.renderSchedule.startTime||Date.now();t.formattedDate=new Date(t.date).toDateString();if(t.times&&t.times instanceof Array&&t.times.length>0)for(var n=0,o=t.times.length;o>n;n++)t.times[n].formattedTime=e(1e3*t.times[n].time);var i=ucsf.shuttle.renderSchedule.target;if(i&&i.innerHTML){var r=new Hogan.Template(function(e,t,n){var o=this;o.b(n=n||"");o.b("<h3>");o.b(o.v(o.f("formattedDate",e,t,0)));o.b('</h3><button onclick="ucsf.shuttle.renderSchedule.startTime=');o.b(o.v(o.f("date",e,t,0)));o.b("-86400000;ucsf.shuttle.renderSchedule.target=this.parentNode.previousSibling;UCSF.Shuttle.times({apikey:'c631ef46e918c82cf81ef4869f0029d4',stopId:ucsf.shuttle.renderSchedule.target.getAttribute('data-stopId'),routeId:document.getElementById('ucsf-schedule-container').getAttribute('data-routeId'),startTime:ucsf.shuttle.renderSchedule.startTime,endTime:ucsf.shuttle.renderSchedule.startTime+86399999},ucsf.shuttle.renderSchedule)\">Previous Day</button><button onclick=\"ucsf.shuttle.renderSchedule.startTime=");o.b(o.v(o.f("date",e,t,0)));o.b("+86400000;ucsf.shuttle.renderSchedule.target=this.parentNode.previousSibling;UCSF.Shuttle.times({apikey:'c631ef46e918c82cf81ef4869f0029d4',stopId:ucsf.shuttle.renderSchedule.target.getAttribute('data-stopId'),routeId:document.getElementById('ucsf-schedule-container').getAttribute('data-routeId'),startTime:ucsf.shuttle.renderSchedule.startTime,endTime:ucsf.shuttle.renderSchedule.startTime+86399999},ucsf.shuttle.renderSchedule)\">Next Day</button><ol class=\"shuttle-times-listing\">");if(o.s(o.f("times",e,t,1),e,t,0,1118,1144,"{{ }}")){o.rs(e,t,function(e,t,n){n.b("<li>");n.b(n.v(n.f("formattedTime",e,t,0)));n.b("</li>")});e.pop()}o.s(o.f("times",e,t,1),e,t,1,0,0,"")||o.b("<li>No times found for selected date.</li>");o.b("</ol>");return o.fl()}),s=r.render(t);if(i.nextSibling)i.nextSibling.innerHTML=s;else{var l=document.createElement("div");l.innerHTML=s;i.parentNode.insertBefore(l)}}};a.renderTrip=function(t){var n=t.plan||{};if(n.hasOwnProperty("itineraries")){for(var o,i,r=n.date?n.date:Date.now(),a=144e5,s=1,l=n.itineraries.length,u=[],p=0;l>p;p++)if(72e5>n.itineraries[p].duration&&n.itineraries[p].endTime>=r-a&&r+a>=n.itineraries[p].endTime){n.itineraries[p].index=s;s++;n.itineraries[p].startTimeFormatted=e(n.itineraries[p].startTime);n.itineraries[p].endTimeFormatted=e(n.itineraries[p].endTime);n.itineraries[p].durationFormatted=Math.round(n.itineraries[p].duration/6e4);if(n.itineraries[p].hasOwnProperty("legs")){i=n.itineraries[p].legs.length;for(var c=0;i>c;c++){o={};o.toName=n.itineraries[p].legs[c].to.name;if("BUS"===n.itineraries[p].legs[c].mode){o.fromName=n.itineraries[p].legs[c].from.name;o.route=n.itineraries[p].legs[c].route;o.routeId=n.itineraries[p].legs[c].routeId;o.startTime=e(n.itineraries[p].legs[c].startTime);o.endTime=e(n.itineraries[p].legs[c].endTime);n.itineraries[p].legs[c].bus=o}"WALK"===n.itineraries[p].legs[c].mode&&(n.itineraries[p].legs[c].walk=o)}}}else u.push(p);p=u.length;for(;p--;)n.itineraries.splice(u[p],1)}var d=new Hogan.Template(function(e,t,n){var o=this;o.b(n=n||"");o.b("<h2>Suggested Routes</h2>");if(o.s(o.f("itineraries",e,t,1),e,t,0,41,568,"{{ }}")){o.rs(e,t,function(e,t,n){n.b("<div><h3>Option ");n.b(n.v(n.f("index",e,t,0)));n.b("</h3><h4>");n.b(n.v(n.f("startTimeFormatted",e,t,0)));n.b(" - ");n.b(n.v(n.f("endTimeFormatted",e,t,0)));n.b(" (");n.b(n.v(n.f("durationFormatted",e,t,0)));n.b(" mins)</h4><ol>");if(n.s(n.f("legs",e,t,1),e,t,0,167,548,"{{ }}")){n.rs(e,t,function(e,t,n){if(n.s(n.f("bus",e,t,1),e,t,0,175,459,"{{ }}")){n.rs(e,t,function(e,t,n){n.b("<li><ul><li><strong>From:</strong> ");n.b(n.v(n.f("fromName",e,t,0)));n.b("</li><li><strong>To:</strong> ");n.b(n.v(n.f("toName",e,t,0)));n.b("</li><li><strong>Shuttle:</strong> ");n.b(n.v(n.f("route",e,t,0)));n.b(' <div class="shuttle-color ');n.b(n.v(n.f("routeId",e,t,0)));n.b('"></div></li><li><strong>Depart:</strong> ');n.b(n.v(n.f("startTime",e,t,0)));n.b("</li><li><strong>Arrive:</strong> ");n.b(n.v(n.f("endTime",e,t,0)));n.b("</li></ul></li>")});e.pop()}if(n.s(n.f("walk",e,t,1),e,t,0,476,539,"{{ }}")){n.rs(e,t,function(e,t,n){n.b("<li><ul><li><strong>Walk to:</strong> ");n.b(n.v(n.f("toName",e,t,0)));n.b("</li></ul></li>")});e.pop()}});e.pop()}n.b("</ol></div>")});e.pop()}o.s(o.f("itineraries",e,t,1),e,t,1,0,0,"")||o.b("<p>No options found.</p>");return o.fl()}),f=document.getElementById("ucsf_shuttle_itineraries");f.innerHTML=d.render(n);f.scrollIntoView()};a.plan=function(){var e=document.getElementById("ucsf_shuttle_trip_form"),t={apikey:"c631ef46e918c82cf81ef4869f0029d4",fromPlace:e.begin.value,toPlace:e.end.value};if("now"!==e.when.value){var n=new Date;t.arriveBy="arrive"===e.when.value;t.time=e.time.value;n.setDate(n.getDate()+parseInt(e.date.value,10));t.date=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()}var o=document.getElementById("ucsf_shuttle_itineraries");o.innerHTML='<div><section class="center"><progress>Loading...</progress></section></div>';UCSF.Shuttle.plan(t,ucsf.shuttle.renderTrip);a.save()};return a}();Modernizr.load({load:"http://apis.ucsf.edu/static/UCSF.Shuttle.js",callback:function(){var e="c631ef46e918c82cf81ef4869f0029d4";UCSF.Shuttle.stops({apikey:e},ucsf.shuttle.renderStops);"/shuttle/list/"===window.location.pathname&&UCSF.Shuttle.routes({apikey:e,stopId:decodeURIComponent(window.location.search.substr(1))},ucsf.shuttle.renderRoutes);"/shuttle/schedule/route/"===window.location.pathname&&window.location.search&&UCSF.Shuttle.stops({apikey:e,routeId:decodeURIComponent(window.location.search.substr(1))},ucsf.shuttle.renderScheduleMenu)}});